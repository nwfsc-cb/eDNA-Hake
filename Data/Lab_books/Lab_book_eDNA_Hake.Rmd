---
title: 'Library Preparation: Samples 1-48 - 16_Prey'
output:
  html_document:
    df_print: paged
editor_options: 
  chunk_output_type: console
---
This is the lab book for the samples from the first biot of the Hake eDNA project -These are 16S_Prey Amplicons. 

```{r loading packages, echo=FALSE}
library (here)
library (tidyverse)
library (knitr)
library(kableExtra)
```

For this Library Prep, the Samples selected are in our googlesheet, and we created a new sheet with the samples selected and the well in which we have put them for PCR1 cleanup 
```{r load dataset, message = F}
Plate22 <- read_csv(here("Data", "Samples_To_Sequence", "plate22.csv")) %>% 
  pivot_longer(-Row, names_to = "Column", values_to = "sample") %>% 
  mutate (Plate = "Plate22")

Plate23 <- read_csv(here("Data", "Samples_To_Sequence", "plate23.csv")) %>% 
  pivot_longer(-Row, names_to = "Column", values_to = "sample") %>% 
  mutate (Plate = "Plate23")

Samples_to_Sequence <- bind_rows(Plate22, Plate23)
```

## Amplification Success so far

I have done a number of PCRs so far. For each PCR Rx, we should record at least the success of each sample and the locus amplified. Another option would be to include here the PCR Conditions for assesment. 


```{r randomnly assign Tags and Libraries to samples}
Ntags=16
NtotalSamples=nrow(OA_Samples)

Nlibraries=ceiling(NtotalSamples/Ntags) 

tagNames=paste0("Tag_", seq(01:Ntags)) # tags names: 1 to 16
libNames=paste0("Lib_", LETTERS[1:Nlibraries]) # lib names: A to F

all_combos=crossing(Tag = tagNames,Lib = libNames) %>% #create all combinations of tags and libraries
  mutate(Combo=paste(Tag ,Lib , sep=".")) %>% # paste them together
  sample_n(size=NtotalSamples) #Randonmize and select as many cases as needed


output=bind_cols(OA_Samples, all_combos) #Bind the columnns
```

One last check that no library-Tag combo has been used more than once
```{r table to check}
with (output, table(Lib,Tag))
```
If all numbers are 1 or 0, then proceed to save the output in the googlesheet. Will skip it this time as I have already done it 
```{r saving to gsheet}
#gs_title("Samples_OA_good") %>% gs_edit_cells( ws = "Sequencing_run_Apr_18b", input = output)	
```
I prepare now some tables with the samples that go with each Tag - so it's easier to load the right primers into PCR2. In this case, I'm using OA_Samples (You could also use 'output', but this data has already been uploaded to the googlesheet).
```{r}
Samples.46 <- read_csv(here("Data","Samples_To_Sequence","PCR_RGS_046_Indexing - Sheet2.csv")) %>% 
  rownames_to_column("Position") %>% 
  slice(1:96) %>% 
  mutate(Row = rep(LETTERS[1:8], 12), 
         Column = rep(1:12,each = 8)) %>% 
  unite(Row,Column, sep = "", col = "Well", remove = F)

Norm_table<-matrix(nrow=8, ncol=12, dimnames = list(LETTERS[1:8], 1:12)) #Empty 96 well plate
Norm_table[with (Samples.46, cbind(Row,Column))] <- with(Samples.46, H20_to_4nM) # Populate it with the Tag that goes on each well
Norm_table[Norm_table < 2] <- "." 
  Norm_table[Norm_table > 20] <- "." 
    kable (Norm_table, align= "c", format = "html") %>%
      kable_styling(bootstrap_options= "striped", full_width = F, position = "center") %>%
      column_spec(1, bold=T) %>%
      column_spec(1:13, width= "1cm")
       

```


```{r PCR50}
Samples.50 <- read_csv(here("Data","Samples_To_Sequence","PCR_RGS_050_Indexing - Sheet2.csv")) %>% 
  rownames_to_column("Position") %>% 
  slice(1:48) %>% 
  mutate(Row = rep(LETTERS[1:8], 6), 
         Column = rep(5:10,each = 8)) %>% 
  unite(Row,Column, sep = "", col = "Well", remove = F)

Norm_table<-matrix(nrow=8, ncol=12, dimnames = list(LETTERS[1:8], 1:12)) #Empty 96 well plate
Norm_table[with (Samples.50, cbind(Row,Column))] <- with(Samples.50, H20_to_4nM) # Populate it with the Tag that goes on each well
Norm_table[Norm_table < 2] <- "." 
  Norm_table[Norm_table > 20] <- "." 
    kable (Norm_table, align= "c", format = "html") %>%
      kable_styling(bootstrap_options= "striped", full_width = F, position = "center") %>%
      column_spec(1, bold=T) %>%
      column_spec(1:13, width= "1cm")
       
```

